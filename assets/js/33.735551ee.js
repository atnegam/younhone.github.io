(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{317:function(t,a,s){"use strict";s.r(a);var _=s(14),r=Object(_.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"chp4-文件和目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chp4-文件和目录"}},[t._v("#")]),t._v(" chp4 文件和目录")]),t._v(" "),a("h3",{attrs:{id:"_4-1-stat-获取文件有关的信息结构系列函数-存于struct-stat结构中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-stat-获取文件有关的信息结构系列函数-存于struct-stat结构中"}},[t._v("#")]),t._v(" 4.1 stat() 获取文件有关的信息结构系列函数（存于struct stat结构中）")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("int stat(const char *restrict pathname, struct stat *restrict buf);\n\nint fstat(int fd, struct stat* buf);\n\nint lstat(const char *restrict pathname, struct stat *restrict buf);\n\nint fstatat(int fd, const char *restrict pathname, struct stat *restrict buf, int flag);\n")])])]),a("h3",{attrs:{id:"_4-2-struct-stat结构解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-struct-stat结构解析"}},[t._v("#")]),t._v(" 4.2 struct stat结构解析")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("struct stat {\n    mode_t　　　　　　　 st_mode;　　 /* file type & mode (permissions) */\n    ino_t　　　　　　　　st_ino;　　　 /* i-node number (serial number) */\n    dev_t　　　　　　　　st_dev;　　　 /* device number (file system) */\n    dev_t　　　　　　　　st_rdev;　　 /* device number for special files */\n    nlink_t　　　　　　　st_nlink;　　/* number of links */\n    uid_t　　　　　　　　st_uid;　　　 /* user ID of owner */\n    gid_t　　　　　　　　st_gid;　　　 /* group ID of owner */\n    off_t　　　　　　　　st_size;　　 /* size in bytes, for regular files */\n    struct timespec　　 st_atime;　　/* time of last access */\n    struct timespec　　 st_mtime;　　/* time of last modification */\n    struct timespec　　 st_ctime;　　/* time of last file status change */\n    blksize_t　　　　　　st_blksize;　/* best I/O block size */\n    blkcnt_t　　　　　　 st_blocks;　 /* number of disk blocks allocated */\n};\n")])])]),a("h4",{attrs:{id:"mode-t-st-mode成员"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mode-t-st-mode成员"}},[t._v("#")]),t._v(" (mode_t)st_mode成员")]),t._v(" "),a("p",[t._v("文件类型位(7种)")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("文件类型")]),t._v(" "),a("th",[t._v("判别宏")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("普通文件")]),t._v(" "),a("td",[t._v("S_ISREC()")])]),t._v(" "),a("tr",[a("td",[t._v("目录文件")]),t._v(" "),a("td",[t._v("S_ISDIR()")])]),t._v(" "),a("tr",[a("td",[t._v("块特殊文件")]),t._v(" "),a("td",[t._v("S_ISBLK()")])]),t._v(" "),a("tr",[a("td",[t._v("字符特殊文件")]),t._v(" "),a("td",[t._v("S_ISCHR()")])]),t._v(" "),a("tr",[a("td",[t._v("管道或FIFO")]),t._v(" "),a("td",[t._v("S_ISFIFO()")])]),t._v(" "),a("tr",[a("td",[t._v("套接字")]),t._v(" "),a("td",[t._v("S_ISSOCK()")])]),t._v(" "),a("tr",[a("td",[t._v("符号链接")]),t._v(" "),a("td",[t._v("S_ISLINK()")])])])]),t._v(" "),a("p",[t._v("文件权限位（9种）")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("常量")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("S_IRUSR")]),t._v(" "),a("td",[t._v("用户读")])]),t._v(" "),a("tr",[a("td",[t._v("S_IWUSR")]),t._v(" "),a("td",[t._v("用户写")])]),t._v(" "),a("tr",[a("td",[t._v("S_IXUSR")]),t._v(" "),a("td",[t._v("用户执行")])]),t._v(" "),a("tr",[a("td",[t._v("S_IRGRP")]),t._v(" "),a("td",[t._v("组读")])]),t._v(" "),a("tr",[a("td",[t._v("S_IRGWP")]),t._v(" "),a("td",[t._v("组写")])]),t._v(" "),a("tr",[a("td",[t._v("S_IRGXP")]),t._v(" "),a("td",[t._v("组执行")])]),t._v(" "),a("tr",[a("td",[t._v("S_IROTH")]),t._v(" "),a("td",[t._v("其他读")])]),t._v(" "),a("tr",[a("td",[t._v("S_IWOTH")]),t._v(" "),a("td",[t._v("其他写")])]),t._v(" "),a("tr",[a("td",[t._v("S_IXOTH")]),t._v(" "),a("td",[t._v("其他执行")])])])]),t._v(" "),a("p",[t._v("执行时设置ID权限位（2种）")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("常量")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("S_ISUID")]),t._v(" "),a("td",[t._v("执行时设置用户ID")])]),t._v(" "),a("tr",[a("td",[t._v("S_ISGID")]),t._v(" "),a("td",[t._v("执行时设置组ID")])])])]),t._v(" "),a("p",[t._v("其他权限位\n粘着位")]),t._v(" "),a("h4",{attrs:{id:"st-uid和st-gid成员"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#st-uid和st-gid成员"}},[t._v("#")]),t._v(" st_uid和st_gid成员")]),t._v(" "),a("p",[t._v("st_uid指定文件用户ID\n"),a("br"),t._v("\nst_gid指定文件组ID")]),t._v(" "),a("h4",{attrs:{id:"st-size成员"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#st-size成员"}},[t._v("#")]),t._v(" st_size成员")]),t._v(" "),a("p",[t._v("文件长度")]),t._v(" "),a("h4",{attrs:{id:"st-nlink成员"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#st-nlink成员"}},[t._v("#")]),t._v(" st_nlink成员")]),t._v(" "),a("p",[t._v("链接记数")]),t._v(" "),a("h4",{attrs:{id:"st-mtim-st-atim-st-ctim成员"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#st-mtim-st-atim-st-ctim成员"}},[t._v("#")]),t._v(" st_mtim st_atim st_ctim成员")]),t._v(" "),a("h3",{attrs:{id:"_4-3-access-按进程实际用户id组id测试访问权限系列函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-access-按进程实际用户id组id测试访问权限系列函数"}},[t._v("#")]),t._v(" 4.3 access() 按进程实际用户ID组ID测试访问权限系列函数")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("int access(const char *pathname, int mode);\n\nint faccessat(int fd, const char *pathname, int mode, int flag);\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("mode")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("R_OK")]),t._v(" "),a("td",[t._v("测试读权限")])]),t._v(" "),a("tr",[a("td",[t._v("W_OK")]),t._v(" "),a("td",[t._v("测试写权限")])]),t._v(" "),a("tr",[a("td",[t._v("X_OK")]),t._v(" "),a("td",[t._v("测试执行权限")])])])]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('#include <stdio.h>\n#include <unistd.h>\nint main(int argc, char *argv[])\n{\n    printf("argc num: %d\\n", argc);\n\n    if(argc != 2)\n        printf("error1\\n");\n    if(access(argv[1], R_OK) < 0)\n        printf("error2\\n");\n    else\n        printf("read access OK\\n");\n    if (open(argv[1], O_RDONLY) < 0)\n        printf("open error\\n");\n    else\n        printf("open OK\\n");\n    return 0;\n}\n')])])]),a("h3",{attrs:{id:"_4-4-umask-为进程设置文件模式创建屏蔽字"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-umask-为进程设置文件模式创建屏蔽字"}},[t._v("#")]),t._v(" 4.4 umask() 为进程设置文件模式创建屏蔽字")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('mode_t umask(mode_t cmask); #返回之前的文件模式创建屏蔽字\n\n#include <stdio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n\n#define RWRWRW (S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH)\n\nint main()\n{\n    umask(0);\n    if(creat("foo", RWRWRW) < 0)\n        printf("create error1\\n");\n    umask(S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH);\n    if (creat("bar", RWRWRW)<0)\n        printf("create error2\\n");\n    return 0;\n}\n')])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("屏蔽位（8进制）")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("0400")]),t._v(" "),a("td",[t._v("用户读")])]),t._v(" "),a("tr",[a("td",[t._v("0200")]),t._v(" "),a("td",[t._v("用户写")])]),t._v(" "),a("tr",[a("td",[t._v("0100")]),t._v(" "),a("td",[t._v("用户执行")])]),t._v(" "),a("tr",[a("td",[t._v("0040")]),t._v(" "),a("td",[t._v("组读")])]),t._v(" "),a("tr",[a("td",[t._v("0020")]),t._v(" "),a("td",[t._v("组写")])]),t._v(" "),a("tr",[a("td",[t._v("0010")]),t._v(" "),a("td",[t._v("组执行")])]),t._v(" "),a("tr",[a("td",[t._v("0004")]),t._v(" "),a("td",[t._v("其他读")])]),t._v(" "),a("tr",[a("td",[t._v("0002")]),t._v(" "),a("td",[t._v("其他写")])]),t._v(" "),a("tr",[a("td",[t._v("0001")]),t._v(" "),a("td",[t._v("其他执行")])])])]),t._v(" "),a("p",[t._v("exp：027 阻止同组成员写你的文件以及其他用户读、写或执行你的文件")]),t._v(" "),a("h3",{attrs:{id:"_4-5-chmod-更改现有文件的访问权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-chmod-更改现有文件的访问权限"}},[t._v("#")]),t._v(" 4.5 chmod() 更改现有文件的访问权限")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("int chmod(const char *pathname, mode_t mode);\n\nint fchmod(int fd, mode_t mode);\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("mode")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("S_ISUID")]),t._v(" "),a("td",[t._v("执行时设置用户ID")])]),t._v(" "),a("tr",[a("td",[t._v("S_ISGID")]),t._v(" "),a("td",[t._v("执行时设置组ID")])]),t._v(" "),a("tr",[a("td",[t._v("S_ISVTX")]),t._v(" "),a("td",[t._v("黏着位")])]),t._v(" "),a("tr",[a("td",[t._v("S_IRUSR")]),t._v(" "),a("td",[t._v("用户读")])]),t._v(" "),a("tr",[a("td",[t._v("S_IWUSR")]),t._v(" "),a("td",[t._v("用户写")])]),t._v(" "),a("tr",[a("td",[t._v("S_IXUSR")]),t._v(" "),a("td",[t._v("用户执行")])]),t._v(" "),a("tr",[a("td",[t._v("S_IRGRP")]),t._v(" "),a("td",[t._v("组读")])]),t._v(" "),a("tr",[a("td",[t._v("S_IRGWP")]),t._v(" "),a("td",[t._v("组写")])]),t._v(" "),a("tr",[a("td",[t._v("S_IRGXP")]),t._v(" "),a("td",[t._v("组执行")])]),t._v(" "),a("tr",[a("td",[t._v("S_IROTH")]),t._v(" "),a("td",[t._v("其他读")])]),t._v(" "),a("tr",[a("td",[t._v("S_IWOTH")]),t._v(" "),a("td",[t._v("其他写")])]),t._v(" "),a("tr",[a("td",[t._v("S_IXOTH")]),t._v(" "),a("td",[t._v("其他执行")])])])]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('#include <stdio.h>\n#include <sys/stat.h>\n\nint main()\n{\n    struct stat statbuf;\n    if(stat("foo", &statbuf) < 0)\n        printf("stat error\\n");\n    if(chmod("foo", (statbuf.st_mode & ~S_IXGRP) | S_ISGID) < 0)\n        printf("chmod error\\n");\n    // if(chmod("bar", 0777) < 0 )\n    if(chmod("bar", S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH) < 0 )\n        printf("chmod error for bar\\n");\n    return 0;\n}\n')])])]),a("h3",{attrs:{id:"_4-6-chown-更改文件的用户id和组id"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-chown-更改文件的用户id和组id"}},[t._v("#")]),t._v(" 4.6 chown() 更改文件的用户ID和组ID")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("int chown(const char *pathname, uid_t owner, gid_t group);\n\n")])])]),a("h3",{attrs:{id:"_4-7-文件系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-文件系统"}},[t._v("#")]),t._v(" 4.7 文件系统")]),t._v(" "),a("h3",{attrs:{id:"_4-8-link-链接操作系列函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-link-链接操作系列函数"}},[t._v("#")]),t._v(" 4.8 link() 链接操作系列函数")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("int link(const char *existingpath, const char *newpath);\n\nint unlink(const char *pathname);\n")])])]),a("h4",{attrs:{id:"rename-文件和目录重命名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rename-文件和目录重命名"}},[t._v("#")]),t._v(" rename() 文件和目录重命名")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("int rename(const char *oldname, const char *newname);\n\n")])])]),a("h3",{attrs:{id:"_4-9-symlink-readlink-创建和读取链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-9-symlink-readlink-创建和读取链接"}},[t._v("#")]),t._v(" 4.9 symlink() readlink() 创建和读取链接")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("int symlink(const char *actualpath, const char *sympath);\n\nssize_t readlink(const char *restrict pathname, char *restrict buf,\n\nsize_t bufsize);\n")])])]),a("h4",{attrs:{id:"_4-10-mkdir-rmdir-创建删除目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-10-mkdir-rmdir-创建删除目录"}},[t._v("#")]),t._v(" 4.10 mkdir() rmdir() 创建删除目录")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("int mkdir(const char *pathname, mode_t mode);\n\nint rmdir(const char *pathname);\n")])])]),a("h4",{attrs:{id:"_4-11-目录操作相关函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-11-目录操作相关函数"}},[t._v("#")]),t._v(" 4.11 目录操作相关函数")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("DIR *opendir(const char *pathname);\n\nDIR *fdopendir(int fd);\n\nstruct dirent *readdir(DIR *dp);\n\nvoid rewinddir(DIR *dp);\n\nint closedir(DIR *dp);\n\nlong telldir(DIR *dp);\n\nvoid seekdir(DIR *dp, long loc);\n")])])]),a("h4",{attrs:{id:"_4-12-chdir-改变进程的工作目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-12-chdir-改变进程的工作目录"}},[t._v("#")]),t._v(" 4.12 chdir() 改变进程的工作目录")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("int chdir(const char *pathname);\n\nint fchdir(int fd);\n")])])]),a("h4",{attrs:{id:"_4-13-获得工作目录完整路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-13-获得工作目录完整路径"}},[t._v("#")]),t._v(" 4.13 获得工作目录完整路径")]),t._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("char *getcwd(char *buf, size_t size);\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);